# FanqieQimaoDownloader å·¥ä½œè®¡åˆ’

> **é¡¹ç›®ç›®æ ‡**: æ„å»ºä¸€ä¸ªPython Webåº”ç”¨ï¼Œä½¿ç”¨Rain API V3æ£€ç´¢ç•ªèŒ„/ä¸ƒçŒ«å°è¯´ï¼Œä¸‹è½½å°é¢å’Œåˆ†ç« èŠ‚å†…å®¹ï¼Œå­˜å‚¨åå¯¼å‡ºEPUBç”µå­ä¹¦ï¼Œæ”¯æŒå¢é‡æ›´æ–°ã€‚

---

## ğŸ—ï¸ é¡¹ç›®æ•´ä½“æ¶æ„

### åˆ†å±‚è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Layer (FastAPI)              â”‚  â† ç”¨æˆ·ç•Œé¢ã€RESTful API
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Service Layer (ä¸šåŠ¡é€»è¾‘)          â”‚  â† ä¸‹è½½ç®¡ç†ã€æ›´æ–°æ£€æµ‹ã€EPUBç”Ÿæˆ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Data Access Layer (SQLAlchemy)   â”‚  â† ORMã€æ•°æ®åº“æ“ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   API Client Layer (Rain API)      â”‚  â† ç•ªèŒ„/ä¸ƒçŒ«APIå°è£…
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Storage Layer (æ–‡ä»¶ç³»ç»Ÿ/æ•°æ®åº“)    â”‚  â† ç« èŠ‚å†…å®¹ã€å°é¢ã€EPUBå­˜å‚¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 1. APIå®¢æˆ·ç«¯æ¨¡å— (`app/api/`)

**ç±»ç»“æ„:**
```python
RainAPIClient (base.py)
  â”œâ”€â”€ __init__(api_key, base_url, platform)
  â”œâ”€â”€ _request(type, params)
  â”œâ”€â”€ _handle_rate_limit()
  â””â”€â”€ _parse_response(response)

FanqieAPI (fanqie.py)
  â”œâ”€â”€ search(keyword, page=1, audio_mode=None)
  â”œâ”€â”€ get_book_detail(book_id)
  â”œâ”€â”€ get_chapter_list(book_id)
  â”œâ”€â”€ get_chapter_content(item_id)
  â””â”€â”€ replace_cover_url(url)

QimaoAPI (qimao.py)
  â””â”€â”€ (same methods as FanqieAPI)
```

**ç‰¹æ€§:**
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶ (æŒ‡æ•°é€€é¿)
- âœ… é€Ÿç‡é™åˆ¶ä¿æŠ¤ (200ç« /å¤©)
- âœ… å°é¢URLè½¬æ¢ (`replaceCover()` å®ç°)
- âœ… æ”¯æŒéŸ³é¢‘æ¨¡å¼ (`@` å‰ç¼€ AIéŸ³é¢‘, `!` å‰ç¼€çœŸäººéŸ³é¢‘)
- âœ… å“åº”ç¼“å­˜ (å¯é€‰)

**APIç«¯ç‚¹æ˜ å°„:**
| typeå‚æ•° | åŠŸèƒ½ | é¢å¤–å‚æ•° |
|---------|------|---------|
| `type=1` | æœç´¢ä¹¦ç± | `keywords`, `page` |
| `type=2` | ä¹¦ç±è¯¦æƒ… | `bookid` |
| `type=3` | ç« èŠ‚åˆ—è¡¨ | `bookid` |
| `type=4` | ç« èŠ‚å†…å®¹ | `itemid` |

---

### 2. æ•°æ®æ¨¡å‹ (`app/models/`)

#### Book (book.py)
```python
Book:
  - id: UUID (ä¸»é”®)
  - platform: Enum[fanqie, qimao]
  - book_id: String (å¹³å°ä¹¦ç±ID)
  - title: String
  - author: String
  - cover_path: String (æœ¬åœ°è·¯å¾„)
  - total_chapters: Integer
  - downloaded_chapters: Integer
  - word_count: Integer
  - creation_status: String (è¿è½½/å®Œç»“)
  - last_chapter_title: String
  - last_update_time: DateTime
  - download_status: Enum[pending, downloading, completed, failed]
  - created_at: DateTime
  - updated_at: DateTime
```

#### Chapter (chapter.py)
```python
Chapter:
  - id: UUID (ä¸»é”®)
  - book_id: UUID (å¤–é”® â†’ Book)
  - item_id: String (å¹³å°ç« èŠ‚ID)
  - title: String
  - volume_name: String (å·å)
  - chapter_index: Integer (é¡ºåºç¼–å·)
  - word_count: Integer
  - content_path: String (å­˜å‚¨è·¯å¾„)
  - download_status: Enum[pending, completed, failed]
  - downloaded_at: DateTime
  - created_at: DateTime
```

#### DownloadTask (task.py)
```python
DownloadTask:
  - id: UUID (ä¸»é”®)
  - book_id: UUID (å¤–é”® â†’ Book)
  - task_type: Enum[full_download, update]
  - status: Enum[pending, running, completed, failed, cancelled]
  - total_chapters: Integer
  - downloaded_chapters: Integer
  - failed_chapters: Integer
  - progress: Float (0-100%)
  - error_message: Text
  - started_at: DateTime
  - completed_at: DateTime
  - created_at: DateTime
```

#### DailyQuota (å¯é€‰ï¼Œç”¨äºé€Ÿç‡é™åˆ¶)
```python
DailyQuota:
  - id: UUID
  - date: Date (å”¯ä¸€ç´¢å¼•)
  - platform: Enum[fanqie, qimao]
  - chapters_downloaded: Integer
  - limit: Integer (é»˜è®¤200)
```

---

### 3. æœåŠ¡å±‚ (`app/services/`)

#### BookService (book_service.py)
```python
BookService:
  + search_books(platform: str, keyword: str, page: int) â†’ List[BookSearchResult]
  + add_book(platform: str, book_id: str) â†’ Book
  + get_book(book_id: UUID) â†’ Book
  + list_books(filters: dict) â†’ List[Book]
  + update_book_metadata(book_id: UUID) â†’ Book
  + delete_book(book_id: UUID, delete_files: bool) â†’ None
  + get_book_statistics(book_id: UUID) â†’ dict
```

#### DownloadService (download_service.py)
```python
DownloadService:
  + download_book(book_id: UUID, start_chapter: int = 0) â†’ DownloadTask
  + download_chapter(chapter_id: UUID, retry: bool = False) â†’ Chapter
  + download_cover(book_id: UUID) â†’ str
  + check_new_chapters(book_id: UUID) â†’ List[ChapterInfo]
  + update_book(book_id: UUID) â†’ DownloadTask
  + retry_failed_chapters(book_id: UUID) â†’ int
  + cancel_task(task_id: UUID) â†’ None
  + get_task_status(task_id: UUID) â†’ DownloadTask
  - _check_daily_quota(platform: str) â†’ bool
  - _record_download(platform: str) â†’ None
```

#### EPUBService (epub_service.py)
```python
EPUBService:
  + generate_epub(book_id: UUID, output_path: str = None) â†’ str
  + update_epub(book_id: UUID) â†’ str
  + validate_epub(file_path: str) â†’ bool
  - _create_epub_structure(book: Book) â†’ EpubBook
  - _add_metadata(epub: EpubBook, book: Book) â†’ None
  - _add_cover(epub: EpubBook, cover_path: str) â†’ None
  - _add_chapters(epub: EpubBook, chapters: List[Chapter]) â†’ None
  - _add_toc(epub: EpubBook, chapters: List[Chapter]) â†’ None
```

#### StorageService (storage_service.py)
```python
StorageService:
  + save_chapter_content(chapter_id: UUID, content: str) â†’ str
  + get_chapter_content(chapter_id: UUID) â†’ str
  + save_cover(book_id: UUID, image_data: bytes) â†’ str
  + get_cover_path(book_id: UUID) â†’ str
  + delete_book_files(book_id: UUID) â†’ None
  + get_storage_stats() â†’ dict
  - _ensure_directory(path: str) â†’ None
  - _generate_file_path(book_id: UUID, file_type: str) â†’ str
```

---

### 4. Webå±‚ (`app/web/`)

#### RESTful API è·¯ç”±è®¾è®¡

**é¡µé¢è·¯ç”±:**
```
GET  /                        # ä¸»é¡µ (ä¹¦ç±åˆ—è¡¨)
GET  /search                  # æœç´¢é¡µé¢
GET  /books/{id}              # ä¹¦ç±è¯¦æƒ…é¡µ
GET  /tasks                   # ä»»åŠ¡åˆ—è¡¨é¡µ
```

**APIè·¯ç”± (`/api/`):**
```
# æœç´¢
POST   /api/search            # æœç´¢ä¹¦ç±
  Body: { platform: str, keyword: str, page: int }
  Response: { books: [BookSearchResult], total: int }

# ä¹¦ç±ç®¡ç†
GET    /api/books             # è·å–ä¹¦ç±åˆ—è¡¨
  Query: ?platform=&status=&page=&limit=
  Response: { books: [Book], total: int, page: int }

POST   /api/books             # æ·»åŠ ä¹¦ç±
  Body: { platform: str, book_id: str }
  Response: { book: Book, task: DownloadTask }

GET    /api/books/{id}        # ä¹¦ç±è¯¦æƒ…
  Response: { book: Book, chapters: [Chapter], statistics: dict }

DELETE /api/books/{id}        # åˆ é™¤ä¹¦ç±
  Query: ?delete_files=true
  Response: { success: bool }

# ä¸‹è½½ç®¡ç†
POST   /api/books/{id}/download   # å¼€å§‹/ç»§ç»­ä¸‹è½½
  Body: { start_chapter: int }
  Response: { task: DownloadTask }

POST   /api/books/{id}/update     # æ›´æ–°ä¹¦ç± (ä¸‹è½½æ–°ç« èŠ‚)
  Response: { task: DownloadTask, new_chapters: int }

POST   /api/books/{id}/retry      # é‡è¯•å¤±è´¥ç« èŠ‚
  Response: { retried_count: int }

# EPUBå¯¼å‡º
GET    /api/books/{id}/epub       # ç”Ÿæˆå¹¶ä¸‹è½½EPUB
  Response: File download (application/epub+zip)

POST   /api/books/{id}/epub       # ç”ŸæˆEPUB (å¼‚æ­¥)
  Response: { file_path: str, file_size: int }

# ä»»åŠ¡ç®¡ç†
GET    /api/tasks                 # ä»»åŠ¡åˆ—è¡¨
  Query: ?status=&page=&limit=
  Response: { tasks: [DownloadTask], total: int }

GET    /api/tasks/{id}            # ä»»åŠ¡è¯¦æƒ…
  Response: { task: DownloadTask }

POST   /api/tasks/{id}/cancel     # å–æ¶ˆä»»åŠ¡
  Response: { success: bool }

# ç³»ç»Ÿä¿¡æ¯
GET    /api/stats                 # ç»Ÿè®¡ä¿¡æ¯
  Response: { total_books: int, total_chapters: int, storage_used: int, daily_quota: dict }
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬è¦æ±‚ | ç”¨é€” |
|------|---------|---------|------|
| **Webæ¡†æ¶** | FastAPI | >=0.104.0 | å¼‚æ­¥æ”¯æŒã€è‡ªåŠ¨APIæ–‡æ¡£ã€ç±»å‹éªŒè¯ |
| **ORM** | SQLAlchemy | >=2.0.0 | æ•°æ®åº“æ“ä½œã€å…³ç³»æ˜ å°„ |
| **æ•°æ®åº“** | SQLite | - | è½»é‡çº§ã€æ— éœ€ç‹¬ç«‹æœåŠ¡ã€å•ç”¨æˆ·åœºæ™¯ |
| **HTTPå®¢æˆ·ç«¯** | httpx | >=0.25.0 | å¼‚æ­¥HTTPè¯·æ±‚ |
| **EPUBç”Ÿæˆ** | ebooklib | >=0.18 | EPUB3æ ‡å‡†æ”¯æŒ |
| **å›¾ç‰‡å¤„ç†** | Pillow | >=10.0.0 | å°é¢æ ¼å¼è½¬æ¢ã€å‹ç¼© |
| **åå°ä»»åŠ¡** | asyncio + threading | Pythonå†…ç½® | å¼‚æ­¥ä¸‹è½½ä»»åŠ¡ã€è¿›åº¦è·Ÿè¸ª |
| **æ•°æ®éªŒè¯** | Pydantic | >=2.0.0 | è¯·æ±‚/å“åº”éªŒè¯ (FastAPIå†…ç½®) |
| **æ¨¡æ¿å¼•æ“** | Jinja2 | >=3.1.0 | HTMLæ¸²æŸ“ |
| **å‰ç«¯** | Alpine.js + TailwindCSS | - | è½»é‡çº§äº¤äº’ + æ ·å¼ |
| **é…ç½®ç®¡ç†** | python-dotenv | - | ç¯å¢ƒå˜é‡åŠ è½½ |

---

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
FanqieQimaoDownloader/
â”œâ”€â”€ app/                          # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                   # FastAPIåº”ç”¨å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                      # APIå®¢æˆ·ç«¯å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py               # RainAPIClientåŸºç±»
â”‚   â”‚   â”œâ”€â”€ fanqie.py             # ç•ªèŒ„å°è¯´API
â”‚   â”‚   â””â”€â”€ qimao.py              # ä¸ƒçŒ«å°è¯´API
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ book.py               # Bookæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ chapter.py            # Chapteræ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ task.py               # DownloadTaskæ¨¡å‹
â”‚   â”‚   â””â”€â”€ quota.py              # DailyQuotaæ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ book_service.py       # ä¹¦ç±ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ download_service.py   # ä¸‹è½½æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ epub_service.py       # EPUBç”ŸæˆæœåŠ¡
â”‚   â”‚   â””â”€â”€ storage_service.py    # å­˜å‚¨æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ web/                      # Webå±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ routes/               # è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ pages.py          # é¡µé¢è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ books.py          # ä¹¦ç±API
â”‚   â”‚   â”‚   â”œâ”€â”€ tasks.py          # ä»»åŠ¡API
â”‚   â”‚   â”‚   â””â”€â”€ stats.py          # ç»Ÿè®¡API
â”‚   â”‚   â”œâ”€â”€ templates/            # Jinja2æ¨¡æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ base.html
â”‚   â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”‚   â”œâ”€â”€ search.html
â”‚   â”‚   â”‚   â”œâ”€â”€ book_detail.html
â”‚   â”‚   â”‚   â””â”€â”€ tasks.html
â”‚   â”‚   â””â”€â”€ static/               # é™æ€èµ„æº
â”‚   â”‚       â”œâ”€â”€ css/
â”‚   â”‚       â”œâ”€â”€ js/
â”‚   â”‚       â””â”€â”€ images/
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                  # Pydantic schemas
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ book.py
â”‚   â”‚   â”œâ”€â”€ chapter.py
â”‚   â”‚   â””â”€â”€ task.py
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ database.py           # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ image_processor.py    # å›¾ç‰‡å¤„ç†
â”‚   â”‚   â”œâ”€â”€ rate_limiter.py       # é€Ÿç‡é™åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ task_manager.py       # åå°ä»»åŠ¡ç®¡ç† (asyncio)
â”‚   â”‚   â””â”€â”€ logger.py             # æ—¥å¿—é…ç½®
â”‚   â”‚
â”‚   â””â”€â”€ config.py                 # é…ç½®ç®¡ç†
â”‚
â”œâ”€â”€ data/                         # æ•°æ®ç›®å½• (ä¸æäº¤åˆ°Git)
â”‚   â”œâ”€â”€ books/                    # ä¹¦ç±å­˜å‚¨
â”‚   â”‚   â””â”€â”€ {book_id}/
â”‚   â”‚       â”œâ”€â”€ cover.jpg         # å°é¢å›¾ç‰‡
â”‚   â”‚       â””â”€â”€ chapters/         # ç« èŠ‚å†…å®¹
â”‚   â”‚           â”œâ”€â”€ 001.txt
â”‚   â”‚           â”œâ”€â”€ 002.txt
â”‚   â”‚           â””â”€â”€ ...
â”‚   â”œâ”€â”€ epubs/                    # å¯¼å‡ºçš„EPUBæ–‡ä»¶
â”‚   â”‚   â””â”€â”€ {book_title}.epub
â”‚   â””â”€â”€ database.db               # SQLiteæ•°æ®åº“
â”‚
â”œâ”€â”€ tests/                        # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_api/
â”‚   â”œâ”€â”€ test_services/
â”‚   â””â”€â”€ test_web/
â”‚
â”œâ”€â”€ reference/                    # å‚è€ƒæ–‡æ¡£ (ç°æœ‰)
â”‚   â”œâ”€â”€ FANQIE_EXAMPLE.txt
â”‚   â”œâ”€â”€ FANQIE_RULES.json
â”‚   â”œâ”€â”€ FANQIE_RULES.md
â”‚   â””â”€â”€ QIMAO_RULES.json
â”‚
â”œâ”€â”€ .github/                      # GitHubé…ç½®
â”‚   â””â”€â”€ copilot-instructions.md
â”‚
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .env                          # ç¯å¢ƒå˜é‡ (ä¸æäº¤)
â”œâ”€â”€ .gitignore
â”œâ”€â”€ requirements.txt              # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ pyproject.toml                # é¡¹ç›®é…ç½® (å¯é€‰)
â”œâ”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
â””â”€â”€ å·¥ä½œè®¡åˆ’.md                    # æœ¬æ–‡æ¡£
```

---

## ğŸ”„ æ ¸å¿ƒå·¥ä½œæµç¨‹

### æµç¨‹1: ä¸‹è½½ä¹¦ç± (å®Œæ•´æµç¨‹)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æœç´¢ä¹¦ç± â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FanqieAPI.search()       â”‚ â† API type=1
â”‚ è¿”å›æœç´¢ç»“æœåˆ—è¡¨          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·é€‰æ‹©ä¹¦ç±å¹¶æ·»åŠ          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BookService.add_book()   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. API type=2 è·å–è¯¦æƒ…    â”‚
â”‚ 2. ä¸‹è½½å¹¶ä¿å­˜å°é¢         â”‚
â”‚ 3. ä¿å­˜Bookåˆ°æ•°æ®åº“       â”‚
â”‚ 4. åˆ›å»ºDownloadTask      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DownloadService.download() â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. API type=3 è·å–ç« èŠ‚åˆ—è¡¨  â”‚
â”‚ 2. åˆ›å»ºChapterè®°å½•          â”‚
â”‚ 3. å¾ªç¯ä¸‹è½½æ¯ç« :            â”‚
â”‚    â”œâ”€ æ£€æŸ¥é€Ÿç‡é™åˆ¶          â”‚
â”‚    â”œâ”€ API type=4 è·å–å†…å®¹   â”‚
â”‚    â”œâ”€ ä¿å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿ        â”‚
â”‚    â””â”€ æ›´æ–°ChapterçŠ¶æ€      â”‚
â”‚ 4. æ›´æ–°Taskè¿›åº¦            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EPUBService.generate()   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. åˆ›å»ºEPUBç»“æ„           â”‚
â”‚ 2. æ·»åŠ å…ƒæ•°æ® (ä¹¦å/ä½œè€…) â”‚
â”‚ 3. æ·»åŠ å°é¢              â”‚
â”‚ 4. æ·»åŠ æ‰€æœ‰ç« èŠ‚å†…å®¹       â”‚
â”‚ 5. ç”Ÿæˆç›®å½• (TOC)        â”‚
â”‚ 6. å¯¼å‡º.epubæ–‡ä»¶         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸‹è½½å®Œæˆæç¤º  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµç¨‹2: æ›´æ–°ä¹¦ç± (å¢é‡æ›´æ–°)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç‚¹å‡»æ›´æ–° â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DownloadService.check_new()  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. API type=3 è·å–æœ€æ–°ç« èŠ‚åˆ—è¡¨ â”‚
â”‚ 2. å¯¹æ¯”æ•°æ®åº“ä¸­max(chapter_index)â”‚
â”‚ 3. è¿”å›æ–°ç« èŠ‚åˆ—è¡¨               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–°ç« èŠ‚æ•° > 0 ?   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚ Yes     â”‚ No
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸‹è½½æ–°ç« èŠ‚â”‚ â”‚ æ— éœ€æ›´æ–°æç¤ºâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EPUBService.update_epub()â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è¯»å–ç°æœ‰EPUB           â”‚
â”‚ 2. è¿½åŠ æ–°ç« èŠ‚             â”‚
â”‚ 3. æ›´æ–°å…ƒæ•°æ®å’ŒTOC        â”‚
â”‚ 4. é‡æ–°å¯¼å‡º              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ›´æ–°å®Œæˆæç¤º  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµç¨‹3: é€Ÿç‡é™åˆ¶å¤„ç†

```
æ¯æ¬¡ä¸‹è½½ç« èŠ‚å‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RateLimiter.check()    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æŸ¥è¯¢DailyQuotaè¡¨     â”‚
â”‚ 2. æ£€æŸ¥todayçš„ä¸‹è½½é‡    â”‚
â”‚ 3. åˆ¤æ–­ < 200 ?        â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ Yes          â”‚ No
     â–¼              â–¼
  å…è®¸ä¸‹è½½      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ æŠ›å‡ºQuotaExceededâ”‚
                â”‚ æ˜¾ç¤ºå‰©ä½™æ—¶é—´      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸‹è½½æˆåŠŸå:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RateLimiter.record()   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æ›´æ–°DailyQuotaè¡¨     â”‚
â”‚ 2. chapters_downloaded += 1â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ é…ç½®æ–‡ä»¶è®¾è®¡

### `.env` ç¯å¢ƒå˜é‡

```ini
# ========== APIé…ç½® ==========
RAIN_API_KEY=YOUR_API_KEY_HERE
RAIN_API_BASE_URL=http://v3.rain.ink
API_TIMEOUT=30
API_RETRY_TIMES=3

# ========== æ•°æ®åº“é…ç½® ==========
DATABASE_URL=sqlite:///./data/database.db

# ========== å­˜å‚¨é…ç½® ==========
DATA_DIR=./data
BOOKS_DIR=./data/books
EPUBS_DIR=./data/epubs
COVERS_DIR=./data/books/{book_id}/cover.jpg
CHAPTERS_DIR=./data/books/{book_id}/chapters

# ========== ä¸‹è½½é™åˆ¶ ==========
DAILY_CHAPTER_LIMIT=200
CONCURRENT_DOWNLOADS=3
DOWNLOAD_DELAY=0.5

# ========== WebæœåŠ¡é…ç½® ==========
HOST=0.0.0.0
PORT=8000
DEBUG=True
RELOAD=True

# ========== æ—¥å¿—é…ç½® ==========
LOG_LEVEL=INFO
LOG_FILE=./logs/app.log

# ========== EPUBé…ç½® ==========
EPUB_LANGUAGE=zh-CN
EPUB_PUBLISHER=FanqieQimaoDownloader
EPUB_COVER_WIDTH=600
EPUB_COVER_HEIGHT=800
```

### `config.py` é…ç½®ç±»

```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # API
    rain_api_key: str
    rain_api_base_url: str = "http://v3.rain.ink"
    api_timeout: int = 30
    api_retry_times: int = 3
    
    # Database (SQLite for all environments)
    database_url: str = "sqlite:///./data/database.db"
    
    # Storage
    data_dir: str = "./data"
    books_dir: str = "./data/books"
    epubs_dir: str = "./data/epubs"
    
    # Download
    daily_chapter_limit: int = 200
    concurrent_downloads: int = 3
    download_delay: float = 0.5
    
    # Web
    host: str = "0.0.0.0"
    port: int = 8000
    debug: bool = True
    
    # EPUB
    epub_language: str = "zh-CN"
    epub_publisher: str = "FanqieQimaoDownloader"
    
    class Config:
        env_file = ".env"
```

---

## ğŸš€ å¼€å‘é˜¶æ®µè§„åˆ’

### Phase 1: åŸºç¡€æ¶æ„æ­å»º (2-3å¤©)
- [x] é¡¹ç›®æ¶æ„è®¾è®¡
- [x] åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„
- [x] é…ç½®å¼€å‘ç¯å¢ƒ (`requirements.txt`, `.env`)
- [x] æ•°æ®åº“æ¨¡å‹å®šä¹‰ (SQLAlchemy)
- [x] æ•°æ®åº“è¿ç§»å·¥å…· (Alembic)

### Phase 2: APIå®¢æˆ·ç«¯å®ç° (2-3å¤©)
- [ ] å®ç° `RainAPIClient` åŸºç±»
- [ ] å®ç° `FanqieAPI` (4ä¸ªæ–¹æ³•)
- [ ] å®ç° `QimaoAPI` (4ä¸ªæ–¹æ³•)
- [ ] å®ç°é€Ÿç‡é™åˆ¶å™¨ (`RateLimiter`)
- [ ] å•å…ƒæµ‹è¯• (APIè°ƒç”¨ã€é”™è¯¯å¤„ç†)

### Phase 3: æœåŠ¡å±‚å®ç° (3-4å¤©)
- [ ] `StorageService` (æ–‡ä»¶è¯»å†™)
- [ ] `BookService` (ä¹¦ç±ç®¡ç†)
- [ ] `DownloadService` (ä¸‹è½½é€»è¾‘)
- [ ] `EPUBService` (EPUBç”Ÿæˆ)
- [ ] é›†æˆæµ‹è¯• (å®Œæ•´ä¸‹è½½æµç¨‹)

### Phase 4: Webå±‚å®ç° (3-4å¤©)
- [ ] FastAPIåº”ç”¨åˆå§‹åŒ–
- [ ] å®ç°APIè·¯ç”± (`/api/books`, `/api/tasks` ç­‰)
- [ ] Pydantic schemaså®šä¹‰
- [ ] HTMLæ¨¡æ¿ (Jinja2)
- [ ] å‰ç«¯äº¤äº’ (Alpine.js)

### Phase 5: åŠŸèƒ½å®Œå–„ (2-3å¤©)
- [ ] å¢é‡æ›´æ–°åŠŸèƒ½
- [ ] ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª
- [ ] é”™è¯¯æ¢å¤æœºåˆ¶
- [ ] æ—¥å¿—ç³»ç»Ÿ
- [ ] å°é¢å›¾ç‰‡å¤„ç†

### Phase 6: æµ‹è¯•ä¸ä¼˜åŒ– (2-3å¤©)
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ– (å¹¶å‘ä¸‹è½½)
- [ ] å¼‚å¸¸åœºæ™¯æµ‹è¯•
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] æ–‡æ¡£ç¼–å†™

### Phase 7: éƒ¨ç½²ä¸å‘å¸ƒ (1-2å¤©)
- [ ] Dockerå®¹å™¨åŒ– (å¯é€‰)
- [ ] éƒ¨ç½²æ–‡æ¡£
- [ ] READMEå®Œå–„
- [ ] å‘å¸ƒv1.0ç‰ˆæœ¬

**é¢„è®¡æ€»å·¥æœŸ**: 15-22å¤©

---

## ğŸ¯ å…³é”®æŠ€æœ¯ç‚¹

### 1. å°é¢URLè½¬æ¢å®ç°

å‚è€ƒ `reference/FANQIE_RULES.json` ä¸­çš„ `replaceCover()`:

```python
def replace_cover_url(original_url: str) -> str:
    """
    è½¬æ¢ç•ªèŒ„å°é¢URLæ ¼å¼
    åŸå§‹: https://sf1-ttcdn-tos.pstatp.com/img/novel-static/xxx~300x400.image
    ç›®æ ‡: https://p6-novel.byteimg.com/origin/novel-static/xxx.image
    """
    if not original_url:
        return ""
    
    # ç§»é™¤åè®®
    url = original_url.replace("https://", "").replace("http://", "")
    
    # æ›¿æ¢åŸŸå
    url = url.split("/", 1)[-1]  # ç§»é™¤åŸåŸŸå
    url = f"p6-novel.byteimg.com/origin/{url}"
    
    # ç§»é™¤å°ºå¯¸åç¼€ (~300x400)
    url = url.split("~")[0]
    
    # æ¸…ç†è·¯å¾„æ®µä¸­çš„æ³¢æµªå·
    parts = url.split("/")
    url = "/".join(part.split("~")[0] for part in parts)
    
    return f"https://{url}"
```

### 2. é€Ÿç‡é™åˆ¶ç­–ç•¥

```python
class RateLimiter:
    def __init__(self, db_session, limit: int = 200):
        self.db = db_session
        self.limit = limit
    
    def can_download(self, platform: str) -> bool:
        today = datetime.now().date()
        quota = self.db.query(DailyQuota).filter_by(
            date=today, 
            platform=platform
        ).first()
        
        if not quota:
            return True
        
        return quota.chapters_downloaded < self.limit
    
    def record_download(self, platform: str):
        today = datetime.now().date()
        quota = self.db.query(DailyQuota).filter_by(
            date=today,
            platform=platform
        ).first()
        
        if not quota:
            quota = DailyQuota(
                date=today,
                platform=platform,
                chapters_downloaded=0,
                limit=self.limit
            )
            self.db.add(quota)
        
        quota.chapters_downloaded += 1
        self.db.commit()
    
    def get_remaining(self, platform: str) -> int:
        today = datetime.now().date()
        quota = self.db.query(DailyQuota).filter_by(
            date=today,
            platform=platform
        ).first()
        
        if not quota:
            return self.limit
        
        return max(0, self.limit - quota.chapters_downloaded)
```

### 3. EPUBå¢é‡æ›´æ–°

```python
from ebooklib import epub

def update_epub(self, book_id: UUID) -> str:
    """å¢é‡æ›´æ–°EPUB"""
    book = self.db.query(Book).get(book_id)
    epub_path = f"{self.epubs_dir}/{book.title}.epub"
    
    # è¯»å–ç°æœ‰EPUB
    existing_epub = epub.read_epub(epub_path)
    
    # è·å–æ–°ç« èŠ‚ (chapter_index > ç°æœ‰æœ€å¤§å€¼)
    max_index = self._get_max_chapter_index_in_epub(existing_epub)
    new_chapters = self.db.query(Chapter).filter(
        Chapter.book_id == book_id,
        Chapter.chapter_index > max_index,
        Chapter.download_status == "completed"
    ).order_by(Chapter.chapter_index).all()
    
    if not new_chapters:
        return epub_path
    
    # æ·»åŠ æ–°ç« èŠ‚
    for chapter in new_chapters:
        content = self.storage.get_chapter_content(chapter.id)
        epub_chapter = epub.EpubHtml(
            title=chapter.title,
            file_name=f"chapter_{chapter.chapter_index}.xhtml",
            content=f"<h1>{chapter.title}</h1><p>{content}</p>"
        )
        existing_epub.add_item(epub_chapter)
    
    # æ›´æ–°TOCå’ŒSpine
    self._update_toc(existing_epub)
    
    # ä¿å­˜
    epub.write_epub(epub_path, existing_epub)
    return epub_path
```

### 4. å¹¶å‘ä¸‹è½½æ§åˆ¶

```python
import asyncio
import httpx

async def download_chapters_concurrent(
    self, 
    chapters: List[Chapter], 
    max_concurrent: int = 3
):
    """å¹¶å‘ä¸‹è½½ç« èŠ‚ (é™åˆ¶å¹¶å‘æ•°)"""
    semaphore = asyncio.Semaphore(max_concurrent)
    
    async def download_with_limit(chapter):
        async with semaphore:
            return await self._download_single_chapter(chapter)
    
    tasks = [download_with_limit(ch) for ch in chapters]
    results = await asyncio.gather(*tasks, return_exceptions=True)
    
    return results
```

---

## ğŸ“Š æ•°æ®åº“Schema (SQLite)

```sql
-- Booksè¡¨
CREATE TABLE books (
    id TEXT PRIMARY KEY,
    platform TEXT NOT NULL,
    book_id TEXT NOT NULL,
    title TEXT NOT NULL,
    author TEXT,
    cover_path TEXT,
    total_chapters INTEGER DEFAULT 0,
    downloaded_chapters INTEGER DEFAULT 0,
    word_count INTEGER,
    creation_status TEXT,
    last_chapter_title TEXT,
    last_update_time DATETIME,
    download_status TEXT DEFAULT 'pending',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(platform, book_id)
);

-- Chaptersè¡¨
CREATE TABLE chapters (
    id TEXT PRIMARY KEY,
    book_id TEXT NOT NULL,
    item_id TEXT NOT NULL,
    title TEXT NOT NULL,
    volume_name TEXT,
    chapter_index INTEGER NOT NULL,
    word_count INTEGER,
    content_path TEXT,
    download_status TEXT DEFAULT 'pending',
    downloaded_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (book_id) REFERENCES books(id) ON DELETE CASCADE,
    UNIQUE(book_id, chapter_index)
);

-- DownloadTasksè¡¨
CREATE TABLE download_tasks (
    id TEXT PRIMARY KEY,
    book_id TEXT NOT NULL,
    task_type TEXT NOT NULL,
    status TEXT DEFAULT 'pending',
    total_chapters INTEGER DEFAULT 0,
    downloaded_chapters INTEGER DEFAULT 0,
    failed_chapters INTEGER DEFAULT 0,
    progress REAL DEFAULT 0.0,
    error_message TEXT,
    started_at DATETIME,
    completed_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (book_id) REFERENCES books(id) ON DELETE CASCADE
);

-- DailyQuotaè¡¨
CREATE TABLE daily_quota (
    id TEXT PRIMARY KEY,
    date DATE NOT NULL,
    platform TEXT NOT NULL,
    chapters_downloaded INTEGER DEFAULT 0,
    limit INTEGER DEFAULT 200,
    UNIQUE(date, platform)
);

-- ç´¢å¼•
CREATE INDEX idx_chapters_book_id ON chapters(book_id);
CREATE INDEX idx_chapters_status ON chapters(download_status);
CREATE INDEX idx_tasks_book_id ON download_tasks(book_id);
CREATE INDEX idx_tasks_status ON download_tasks(status);
CREATE INDEX idx_quota_date ON daily_quota(date);
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- APIå®¢æˆ·ç«¯: Mock HTTPå“åº”
- æœåŠ¡å±‚: Mockæ•°æ®åº“æ“ä½œ
- å·¥å…·å‡½æ•°: çº¯å‡½æ•°æµ‹è¯•

### é›†æˆæµ‹è¯•
- å®Œæ•´ä¸‹è½½æµç¨‹ (æœç´¢â†’æ·»åŠ â†’ä¸‹è½½â†’ç”ŸæˆEPUB)
- æ›´æ–°æµç¨‹ (æ£€æµ‹æ–°ç« èŠ‚â†’ä¸‹è½½â†’æ›´æ–°EPUB)
- é”™è¯¯æ¢å¤ (ç½‘ç»œä¸­æ–­ã€é€Ÿç‡é™åˆ¶)

### ç«¯åˆ°ç«¯æµ‹è¯•
- Webç•Œé¢æ“ä½œæµç¨‹
- APIæ¥å£å®Œæ•´æ€§
- å¹¶å‘ä¸‹è½½ç¨³å®šæ€§

---

## ğŸ“ åç»­ä¼˜åŒ–æ–¹å‘

### æ€§èƒ½ä¼˜åŒ–
- [ ] ä¼˜åŒ– asyncio ä»»åŠ¡è°ƒåº¦
- [ ] SQLite WALæ¨¡å¼ä¼˜åŒ–å¹¶å‘æ€§èƒ½
- [ ] å†…å­˜ç¼“å­˜APIå“åº” (LRU Cache)
- [ ] å¹¶å‘ä¸‹è½½æ•°åŠ¨æ€è°ƒæ•´

### åŠŸèƒ½æ‰©å±•
- [ ] ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [ ] ä¹¦ç±åˆ†ç±»ç®¡ç†
- [ ] å¯¼å‡ºå…¶ä»–æ ¼å¼ (PDF, MOBI)
- [ ] WebSocketå®æ—¶è¿›åº¦æ¨é€
- [ ] ä¹¦æ¶åŒæ­¥åŠŸèƒ½ (Fanqieè´¦å·é›†æˆ)

### ç”¨æˆ·ä½“éªŒ
- [ ] è¿›åº¦æ¡å¯è§†åŒ–
- [ ] æ‰¹é‡æ“ä½œ (æ‰¹é‡æ·»åŠ /ä¸‹è½½)
- [ ] è‡ªå®šä¹‰EPUBæ ·å¼
- [ ] ç§»åŠ¨ç«¯é€‚é…

### è¿ç»´ä¸ç›‘æ§
- [ ] Dockeréƒ¨ç½² (å¯é€‰)
- [ ] å¥åº·æ£€æŸ¥æ¥å£
- [ ] åŸºç¡€æ€§èƒ½æŒ‡æ ‡ (å†…å­˜/ç£ç›˜ä½¿ç”¨)
- [ ] æ—¥å¿—è½®è½¬ä¸å½’æ¡£

---

## ğŸ“š å‚è€ƒèµ„æ–™

- **APIæ–‡æ¡£**: `reference/FANQIE_RULES.md`, `reference/QIMAO_RULES.json`
- **é˜…è¯»3è§„åˆ™**: `reference/FANQIE_RULES.json` (JavaScriptè§£æè§„åˆ™)
- **APIç¤ºä¾‹**: `reference/FANQIE_EXAMPLE.txt` (å®Œæ•´å“åº”ç¤ºä¾‹)
- **FastAPIæ–‡æ¡£**: https://fastapi.tiangolo.com/
- **ebooklibæ–‡æ¡£**: https://github.com/aerkalov/ebooklib
- **EPUB3è§„èŒƒ**: https://www.w3.org/publishing/epub3/

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ26æ—¥  
**ç»´æŠ¤è€…**: AI Assistant
